/*
 The JeX JavaScript library.

 This library is free software: you can redistribute it and/or modify it
 under the terms of the GNU Lesser General Public License as published by
 the Free Software Foundation, either version 3 of the License, or (at your
 option) any later version.

 This library is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public
 License for more details.

 You should have received a copy of the GNU Lesser General Public License
 along with this library. If not, see <http://www.gnu.org/licenses/>.
*/
var jex={};jex.console={};jex.console.assert=function(a,b){jex.console.add_to_buffer_("assert",arguments);jex.console.flush_buffer_()};jex.console.clear=function(){jex.console.add_to_buffer_("clear",arguments);jex.console.flush_buffer_()};jex.console.count=function(a){jex.console.add_to_buffer_("count",arguments);jex.console.flush_buffer_()};jex.console.dir=function(a){jex.console.add_to_buffer_("dir",arguments);jex.console.flush_buffer_()};
jex.console.error=function(a,b){jex.console.add_to_buffer_("error",arguments);jex.console.flush_buffer_()};jex.console.exception=function(a,b){jex.console.error(a,b)};jex.console.group=function(){jex.console.add_to_buffer_("group",arguments);jex.console.flush_buffer_()};jex.console.groupCollapsed=function(){jex.console.add_to_buffer_("groupCollapsed",arguments);jex.console.flush_buffer_()};jex.console.groupEnd=function(){jex.console.add_to_buffer_("groupEnd",arguments);jex.console.flush_buffer_()};
jex.console.info=function(a,b){jex.console.add_to_buffer_("info",arguments);jex.console.flush_buffer_()};jex.console.log=function(a,b){jex.console.add_to_buffer_("log",arguments);jex.console.flush_buffer_()};jex.console.profile=function(a){jex.console.add_to_buffer_("profile",arguments);jex.console.flush_buffer_()};jex.console.profileEnd=function(a){jex.console.add_to_buffer_("profileEnd",arguments);jex.console.flush_buffer_()};
jex.console.table=function(a){jex.console.add_to_buffer_("table",arguments);jex.console.flush_buffer_()};jex.console.time=function(a){jex.console.add_to_buffer_("time",arguments);jex.console.flush_buffer_()};jex.console.timeEnd=function(a){jex.console.add_to_buffer_("timeEnd",arguments);jex.console.flush_buffer_()};jex.console.trace=function(a,b){jex.console.add_to_buffer_("trace",arguments);jex.console.flush_buffer_()};jex.console.warn=function(a,b){jex.console.add_to_buffer_("warn",arguments);jex.console.flush_buffer_()};
jex.console.buffer_=[];jex.console.add_to_buffer_=function(a,b){jex.console.buffer_.push({console_function:a,console_arguments:b})};jex.console.flush_buffer_=function(){if(window.console)for(var a;a=jex.console.buffer_.shift();)jex.console.execute_(a.console_function,a.console_arguments)};
jex.console.execute_=function(a,b){window.console[a]?"object"===typeof window.console[a]?Function.prototype.apply.apply(window.console[a],[window.console,b]):window.console[a].apply(window.console,b):"log"!==a&&jex.console.execute_("log",b)};jex.ie={};jex.ie.less_than=function(a){return jex.ie.get_version()?jex.ie.get_version()<a:!1};jex.ie.greater_than=function(a){return jex.ie.get_version()?jex.ie.get_version()>a:!1};jex.ie.equals=function(a){return a===jex.ie.get_version()};
jex.ie.get_version=function(){jex.ie.version_||(jex.ie.version_=document.all&&window.atob?10:document.all&&!window.atob&&document.addEventListener?9:document.all&&!document.addEventListener&&document.querySelector?8:document.all&&!document.querySelector&&window.XMLHttpRequest?7:document.all&&!window.XMLHttpRequest&&document.compatMode?6:null);return jex.ie.version_};jex.type=function(a,b){1===arguments.length&&(b=!1);if(null===a)return"null";if(void 0===a)return"undefined";if(!1===b){if("string"===typeof a||a instanceof String)return"string";if("number"===typeof a||a instanceof Number)return"number";if("boolean"===typeof a||a instanceof Boolean)return"boolean";if(a instanceof Array)return"array";if(a instanceof Function)return"function";if(a instanceof RegExp)return"regexp";if(a instanceof Date)return"date"}var c=Object.prototype.toString.call(a);return jex.type.map_[c]?
jex.type.map_[c]:c.match(jex.type.regexp_)[1].toLowerCase()};jex.type.regexp_=/\s([a-zA-Z]+)/;jex.type.map_={"[object Array]":"array","[object Boolean]":"boolean","[object Date]":"date","[object Function]":"function","[object Number]":"number","[object Null]":"null","[object Object]":"object","[object RegExp]":"regexp","[object String]":"string","[object Undefined]":"undefined"};jex.table=function(a){var b=a.rows||(!0===a.header?1:0);this.columns_=a.columns||0;this.table_=rocket.createElement("table");this.table_.setAttribute({cellpadding:"0",cellspacing:"0"});this.tbody_=rocket.createElement("tbody");this.trs_=[];this.tds_=[];!0===a.header&&(b--,this.thead_=rocket.createElement("thead"),a=this.render_tr_("th"),this.trs_.push(a),this.thead_.appendChild(a),this.table_.appendChild(this.thead_));rocket.createElement("tbody");for(var c=0;c<b;c++)a=this.render_tr_("td"),this.trs_.push(a),
this.tbody_.appendChild(a);this.table_.appendChild(this.tbody_)};jex.table.prototype.render_tr_=function(a,b){for(var c=b||this.trs_.length,d=rocket.createElement("tr"),e=[],f,g=0;g<this.columns_;g++)f=rocket.createElement(a),e.push(f),d.appendChild(f);this.tds_.splice(c,0,e);return d};jex.table.prototype.fill_row=function(a,b){for(var c=0,d=b.length;c<d;c++)"object"===jex.type(b[c])?(this.td(c,a).innerHTML(""),this.td(c,a).appendChild(b[c])):this.td(c,a).innerHTML(b[c])};
jex.table.prototype.add_row=function(a){var b=a||this.trs_.length;a=this.render_tr_("td",a);this.tbody_.insertBefore(a,this.trs_[b]);this.trs_.splice(b,0,a);return b};jex.table.prototype.remove_row=function(a){this.trs_[a].parentNode().removeChild(this.trs_[a]);this.trs_.splice(a,1);this.tds_.splice(a,1);return this.trs_.length};jex.table.prototype.table=function(){return this.table_};jex.table.prototype.tbody=function(){return this.tbody_};jex.table.prototype.tr=function(a){return this.trs_[a]};
jex.table.prototype.td=function(a,b){return this.tds_[b][a]};jex.debug={};jex.debug.listener={};
jex.debug.listener.render_count=function(){var a=rocket.createElement("div").style({position:"fixed",bottom:"0",right:"0",background:"#fff",padding:"4px",opacity:".8"});a.innerHTML("Listeners: "+jex.debug.listener.get_count());document.body.appendChild(a[0]);var b=rocket.EventTarget.prototype.addEventListener;rocket.EventTarget.prototype.addEventListener=function(){b.apply(this,arguments);a.innerHTML("Listeners: "+jex.debug.listener.get_count())};var c=rocket.EventTarget.prototype.removeEventListener;rocket.EventTarget.prototype.removeEventListener=
function(){c.apply(this,arguments);a.innerHTML("Listeners: "+jex.debug.listener.get_count())}};jex.debug.listener.get_count=function(){var a=0,b,c=rocket.EventTarget.getListenerTree(),d;for(d in c){b=parseInt(d,10);for(var e in c[b])for(var f in c[b][e])a+=c[b][e][f].length}return a};jex.hashchange=function(){var a=this;this.hash_=location.hash;!0===jex.ie.less_than(8)&&(this.iframe_=rocket.createElement("iframe"),rocket.$("body").appendChild(this.iframe_),this.iframe_.setAttribute({src:"javascript:void(0)"}));"onhashchange"in window?window.onhashchange=function(){a.dispatchEvent("hashchange")}:rocket.setInterval(function(){a.check_()},1E3)};rocket.inherits(jex.hashchange,rocket.EventTarget);
jex.hashchange.prototype.check_=function(){if(location.hash!==this.hash_)this.set_(location.hash),this.dispatchEvent("hashchange");else if(this.iframe_){var a=this.iframe_[0];a.contentWindow.location.hash!==this.hash_&&(this.set_(a.contentWindow.location.hash),this.dispatchEvent("hashchange"))}};jex.hashchange.prototype.set_=function(a){this.hash_=a;if(this.iframe_){var b=this.iframe_[0];b.contentWindow.document.open();b.contentWindow.document.close();b.contentWindow.location.hash=a}};jex.version="14.09";jex.hotkey={};jex.hotkey.hotkeys_={};jex.hotkey.active_groups_=[""];jex.hotkey.enabled_=!1;jex.hotkey.current_hotkey_="";jex.hotkey.is_active_=!1;jex.hotkey.sequence_timeout_=1E3;jex.hotkey.paused_=!1;
jex.hotkey.keycode_map_={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",186:";",187:"=",188:",",109:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",
123:"f12",13:"enter",32:"space",20:"capslock",144:"numlock",145:"scrolllock",45:"insert",46:"delete",36:"home",35:"end",33:"pageup",34:"pagedown",9:"tab",19:"break",8:"backspace",27:"escape",107:"+",106:"*",111:"/",110:".",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",91:"start",92:"start",93:"menu",224:"command",16:"shift",17:"ctrl",18:"alt"};
jex.hotkey.shift_keycode_map_={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",186:":",187:"+",188:"<",109:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'};
jex.hotkey.add=function(a){for(var b=[].concat(a.hotkey),c=[].concat(a.input||[]),d=0,e=c.length;d<e;++d)c[d]=c[d][0];for(var f,g,h,d=0,e=b.length;d<e;++d)f=jex.hotkey.normalize_(b[d]),g=a.callback,h=a.group||"",!1===jex.hotkey.hotkeys_.hasOwnProperty(h)&&(jex.hotkey.hotkeys_[h]={}),jex.hotkey.hotkeys_[h][f]={callback:g,inputs:c};jex.hotkey.check_listener_()};
jex.hotkey.check_listener_=function(){var a=!1;if(!1===jex.hotkey.paused_)for(var b=0,c=jex.hotkey.active_groups_.length;b<c;++b)if(0<rocket.keys(jex.hotkey.hotkeys_[jex.hotkey.active_groups_[b]]).length){a=!0;break}!0===a?!1===jex.hotkey.enabled_&&(rocket.$(window).addEventListener("keydown.jex.hotkey",jex.hotkey.keydown_handler_),jex.hotkey.enabled_=!0):(rocket.$(window).removeEventListener(".jex.hotkey"),jex.hotkey.enabled_=!1)};jex.hotkey.pause=function(){jex.hotkey.paused_=!0};
jex.hotkey.unpause=function(){jex.hotkey.paused_=!1};jex.hotkey.remove=function(a,b){b=b||"";a=jex.hotkey.normalize_(a);delete jex.hotkey.hotkeys_[b][a];jex.hotkey.check_listener_()};jex.hotkey.remove_group=function(a){delete jex.hotkey.hotkeys_[a];jex.hotkey.active_groups_.splice(rocket.indexOf(jex.hotkey.active_groups_,a),1);jex.hotkey.check_listener_()};
jex.hotkey.enable_group=function(a){a=rocket.arrayify(a);for(var b=0,c=a.length;b<c;++b)jex.hotkey.active_groups_.push(a[b]);jex.hotkey.active_groups_=rocket.filter(jex.hotkey.active_groups_,function(a,b,c){return rocket.indexOf(c,a)===b})};jex.hotkey.disable_group=function(a){a=rocket.arrayify(a);for(var b=0,c=a.length;b<c;++b)jex.hotkey.active_groups_.splice(rocket.indexOf(jex.hotkey.active_groups_,a[b]),1);jex.hotkey.check_listener_()};
jex.hotkey.set_group=function(a){jex.hotkey.active_groups_=rocket.arrayify(a);jex.hotkey.check_listener_()};jex.hotkey.remove_all=function(){!0===jex.hotkey.is_active_&&(jex.hotkey.hotkeys_={},jex.hotkey.active_groups_=[""],jex.hotkey.check_listener_())};
jex.hotkey.normalize_=function(a){a=rocket.trim(a).replace(/\s{2,}/g," ").toLowerCase();a=a.replace("ctrl+shift","shift+ctrl");a=a.replace("alt+shift","shift+alt");a=a.replace("alt+ctrl","ctrl+alt");a=a.replace("shift+alt+ctrl","shift+ctrl+alt");a=a.replace("ctrl+shift+alt","shift+ctrl+alt");a=a.replace("ctrl+alt+shift","shift+ctrl+alt");a=a.replace("alt+shift+ctrl","shift+ctrl+alt");a=a.replace("alt+ctrl+shift","shift+ctrl+alt");a=a.replace("plus","+");a=a.replace("return","enter");a=a.replace(/\bins\b/g,
"insert");a=a.replace(/\bdel\b/g,"delete");a=a.replace(/\besc\b/g,"escape");a=a.replace("pgup","pageup");a=a.replace("pgdn","pagedown");a=a.replace("pgdown","pagedown");return a=a.replace("break","pause")};
jex.hotkey.keydown_handler_=function(a){var b=a.target,b="INPUT"===b.tagName||"SELECT"===b.tagName||"TEXTAREA"===b.tagName||!0===b.isContentEditable;!0===b&&jex.hotkey.reset_();var c="keycode_map_";!0===a.originalEvent.shiftKey&&16!==a.which&&jex.hotkey.shift_keycode_map_[a.which+""]&&(c="shift_keycode_map_");jex.hotkey[c][a.which]&&(""!==jex.hotkey.current_hotkey_&&(jex.hotkey.current_hotkey_+=" "),jex.hotkey.current_hotkey_+=jex.hotkey[c][a.which]);for(var c=!1,d,e=0,f=jex.hotkey.active_groups_.length;e<
f;++e)if(jex.hotkey.hotkeys_[jex.hotkey.active_groups_[e]][jex.hotkey.current_hotkey_]){d=jex.hotkey.hotkeys_[jex.hotkey.active_groups_[e]][jex.hotkey.current_hotkey_];if(0<d.inputs.length){if(-1===rocket.indexOf(d.inputs,a.target)){jex.hotkey.reset_();return}}else if(!0===b){jex.hotkey.reset_();return}c=!0;d.callback()}!0===c&&(jex.hotkey.reset_(),a.preventDefault());!1===c&&(clearTimeout(jex.hotkey.sequence_timeout_handle_),jex.hotkey.sequence_timeout_handle_=setTimeout(jex.hotkey.reset_,jex.hotkey.sequence_timeout_))};
jex.hotkey.reset_=function(){clearTimeout(jex.hotkey.sequence_timeout_handle_);jex.hotkey.current_hotkey_=""};jex.cora_request=function(){this.api_calls_=[];this.xhr_=new rocket.XMLHttpRequest};jex.cora_request.prototype.add_api_call=function(a,b,c,d){a=new jex.cora_request.api_call(a,b,d);c&&a.set_arguments(c);this.api_calls_.push(a);return a};jex.cora_request.prototype.remove_api_call=function(a){this.api_calls_.splice(rocket.indexOf(this.api_calls_,a),1)};jex.cora_request.prototype.remove_all_api_calls=function(){this.api_calls_=[]};
jex.cora_request.prototype.send=function(){var a=this;delete this.execution_start_;delete this.execution_end_;this.xhr_.data={};if(1===this.api_calls_.length)rocket.extend(this.xhr_.data,this.api_calls_[0].get_object());else{this.xhr_.data.batch=[];for(var b=0,c=this.api_calls_.length;b<c;++b)this.api_calls_[b].get_alias()||this.api_calls_[b].set_alias(this.api_calls_[b].get_resource()+"."+this.api_calls_[b].get_method()),this.xhr_.data.batch.push(this.api_calls_[b].get_object());this.xhr_.data.batch=
rocket.JSON.stringify(this.xhr_.data.batch)}this.xhr_.data.api_key=jex.cora_request.api_key_;this.xhr_.open("POST",jex.cora_request.api_uri_);this.xhr_.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.xhr_.addEventListener("success",function(){a.execution_end_=new Date;try{var b=rocket.JSON.parse(this.responseText)}catch(c){if(jex.console.error("API call failed (could not decode JSON)"),a.error_callback_){a.error_callback_({response_text:this.responseText});return}}!1===b.success?
(jex.console.error("API call failed (success false)"),a.error_callback_&&a.error_callback_({data:b.data})):a.success_callback_&&a.success_callback_(b.data)});this.xhr_.addEventListener("error",function(){jex.console.error("API call failed (status not 200)");a.execution_end_=new Date;a.error_callback_&&a.error_callback_({response_text:this.responseText})});this.execution_start_=new Date;this.xhr_.send()};jex.cora_request.prototype.abort=function(){this.xhr_.abort()};
jex.cora_request.prototype.get_execution_time=function(){return this.execution_end_&&this.execution_start_?this.execution_end_.getTime()-this.execution_start_.getTime():null};jex.cora_request.prototype.set_success_callback=function(a){this.success_callback_=a};jex.cora_request.prototype.set_error_callback=function(a){this.error_callback_=a};jex.cora_request.set_api_uri=function(a){jex.cora_request.api_uri_=a};jex.cora_request.set_api_key=function(a){jex.cora_request.api_key_=a};jex.cora_request.api_call=function(a,b,c){this.resource_=a;this.method_=b;this.alias_=c};jex.cora_request.api_call.prototype.set_arguments=function(a){this.arguments_=a};jex.cora_request.api_call.prototype.set_alias=function(a){this.alias_=a};jex.cora_request.api_call.prototype.get_alias=function(){return this.alias_};jex.cora_request.api_call.prototype.get_resource=function(){return this.resource_};jex.cora_request.api_call.prototype.get_method=function(){return this.method_};
jex.cora_request.api_call.prototype.get_object=function(){var a={resource:this.resource_,method:this.method_};this.alias_&&(a.alias=this.alias_);this.arguments_&&(a.arguments=rocket.JSON.stringify(this.arguments_));return a};
